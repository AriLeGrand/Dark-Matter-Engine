\doxysection{bt\+Deformable\+Backward\+Euler\+Objective.\+h}
\hypertarget{bt_deformable_backward_euler_objective_8h_source}{}\label{bt_deformable_backward_euler_objective_8h_source}\index{C:/Users/quant/source/repos/Dark-\/Matter-\/Engine/ENGINE/Libraries/include/Bullet/BulletSoftBody/btDeformableBackwardEulerObjective.h@{C:/Users/quant/source/repos/Dark-\/Matter-\/Engine/ENGINE/Libraries/include/Bullet/BulletSoftBody/btDeformableBackwardEulerObjective.h}}
\mbox{\hyperlink{bt_deformable_backward_euler_objective_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ Written\ by\ Xuchen\ Han\ <xuchenhan2015@u.northwestern.edu>}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ }}
\DoxyCodeLine{00004\ \textcolor{comment}{\ Bullet\ Continuous\ Collision\ Detection\ and\ Physics\ Library}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ Copyright\ (c)\ 2019\ Google\ Inc.\ http://bulletphysics.org}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ This\ software\ is\ provided\ 'as-\/is',\ without\ any\ express\ or\ implied\ warranty.}}
\DoxyCodeLine{00007\ \textcolor{comment}{\ In\ no\ event\ will\ the\ authors\ be\ held\ liable\ for\ any\ damages\ arising\ from\ the\ use\ of\ this\ software.}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ Permission\ is\ granted\ to\ anyone\ to\ use\ this\ software\ for\ any\ purpose,}}
\DoxyCodeLine{00009\ \textcolor{comment}{\ including\ commercial\ applications,\ and\ to\ alter\ it\ and\ redistribute\ it\ freely,}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ subject\ to\ the\ following\ restrictions:}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ 1.\ The\ origin\ of\ this\ software\ must\ not\ be\ misrepresented;\ you\ must\ not\ claim\ that\ you\ wrote\ the\ original\ software.\ If\ you\ use\ this\ software\ in\ a\ product,\ an\ acknowledgment\ in\ the\ product\ documentation\ would\ be\ appreciated\ but\ is\ not\ required.}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ 2.\ Altered\ source\ versions\ must\ be\ plainly\ marked\ as\ such,\ and\ must\ not\ be\ misrepresented\ as\ being\ the\ original\ software.}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ 3.\ This\ notice\ may\ not\ be\ removed\ or\ altered\ from\ any\ source\ distribution.}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#ifndef\ BT\_BACKWARD\_EULER\_OBJECTIVE\_H}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#define\ BT\_BACKWARD\_EULER\_OBJECTIVE\_H}}
\DoxyCodeLine{00018\ \textcolor{comment}{//\#include\ "{}btConjugateGradient.h"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bt_deformable_lagrangian_force_8h}{btDeformableLagrangianForce.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bt_deformable_mass_spring_force_8h}{btDeformableMassSpringForce.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bt_deformable_gravity_force_8h}{btDeformableGravityForce.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bt_deformable_corotated_force_8h}{btDeformableCorotatedForce.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bt_deformable_mouse_picking_force_8h}{btDeformableMousePickingForce.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bt_deformable_linear_elasticity_force_8h}{btDeformableLinearElasticityForce.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bt_deformable_neo_hookean_force_8h}{btDeformableNeoHookeanForce.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bt_deformable_contact_projection_8h}{btDeformableContactProjection.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bt_preconditioner_8h}{btPreconditioner.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{comment}{//\ \#include\ "{}btDeformableMultiBodyDynamicsWorld.h"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bt_quickprof_8h}{LinearMath/btQuickprof.h}}"{}}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classbt_deformable_backward_euler_objective_a08186bb5c8178c4a2858bdc729e2cd12}{btDeformableBackwardEulerObjective}}}
\DoxyCodeLine{00032\ \{}
\DoxyCodeLine{00033\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{keyword}{enum}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_ac59c9d8a49ee1d054f9fae9111834d1d}{\_}}}
\DoxyCodeLine{00035\ \ \ \ \ \{}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_ac59c9d8a49ee1d054f9fae9111834d1daf5c9978db4229dd8f99960e95b3619b0}{Mass\_preconditioner}},}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_ac59c9d8a49ee1d054f9fae9111834d1da01271506363505443a0b9f37f8a626ee}{KKT\_preconditioner}}}
\DoxyCodeLine{00038\ \ \ \ \ \};}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classbt_aligned_object_array}{btAlignedObjectArray<btVector3>}}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}};}
\DoxyCodeLine{00041\ \ \ \ \ \mbox{\hyperlink{bt_scalar_8h_a1e5824cfc8adbf5a77f2622132d16018}{btScalar}}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a4afec8e005cc03deca05f5136c58c8e5}{m\_dt}};}
\DoxyCodeLine{00042\ \ \ \ \ \mbox{\hyperlink{classbt_aligned_object_array}{btAlignedObjectArray<btDeformableLagrangianForce*>}}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a48f0e64adf5cf2302037f73c6e3455a8}{m\_lf}};}
\DoxyCodeLine{00043\ \ \ \ \ \mbox{\hyperlink{classbt_aligned_object_array}{btAlignedObjectArray<btSoftBody*>}}\&\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a8ac48196a5abb94fcb4aae7a9b344346}{m\_softBodies}};}
\DoxyCodeLine{00044\ \ \ \ \ \mbox{\hyperlink{class_preconditioner}{Preconditioner}}*\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_ab168566afac15059e59e12c83c975f23}{m\_preconditioner}};}
\DoxyCodeLine{00045\ \ \ \ \ \mbox{\hyperlink{classbt_deformable_contact_projection}{btDeformableContactProjection}}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a25ce6dacbbc16e7dd0f56990c04c3806}{m\_projection}};}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a26f98550b1340dc4899ad0b8bffa38a0}{m\_backupVelocity}};}
\DoxyCodeLine{00047\ \ \ \ \ \mbox{\hyperlink{classbt_aligned_object_array}{btAlignedObjectArray<btSoftBody::Node*>}}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a583aeeb9b2c6e30ce4d3ab52373c2b30}{m\_nodes}};}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_ad515c0c1cffa17554546f366c88a7b88}{m\_implicit}};}
\DoxyCodeLine{00049\ \ \ \ \ \mbox{\hyperlink{class_mass_preconditioner}{MassPreconditioner}}*\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a70eceeb1ce7a68c775d6ded18659cef7}{m\_massPreconditioner}};}
\DoxyCodeLine{00050\ \ \ \ \ \mbox{\hyperlink{class_k_k_t_preconditioner}{KKTPreconditioner}}*\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_af2c63b6181878651baf95631be57e4fc}{m\_KKTPreconditioner}};}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a08186bb5c8178c4a2858bdc729e2cd12}{btDeformableBackwardEulerObjective}}(\mbox{\hyperlink{classbt_aligned_object_array}{btAlignedObjectArray<btSoftBody*>}}\&\ softBodies,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ backup\_v);}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_ad0d563c492443c70546e6e1cfb305fb7}{\string~btDeformableBackwardEulerObjective}}();}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_af880ddb26467e426a54ca18e53144048}{initialize}}()\ \{\}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{comment}{//\ compute\ the\ rhs\ for\ CG\ solve,\ i.e,\ add\ the\ dt\ scaled\ implicit\ force\ to\ residual}}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a44805fb64b0a1b7219b6b2787c993b5d}{computeResidual}}(\mbox{\hyperlink{bt_scalar_8h_a1e5824cfc8adbf5a77f2622132d16018}{btScalar}}\ dt,\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ residual);}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{comment}{//\ add\ explicit\ force\ to\ the\ velocity}}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a23f152d82845b7bf271d2f802bb6a347}{applyExplicitForce}}(\mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ force);}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{comment}{//\ apply\ force\ to\ velocity\ and\ optionally\ reset\ the\ force\ to\ zero}}
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a43165e1f9495f162c4d95042681131e6}{applyForce}}(\mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ force,\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{b3_vector3_8h_a47affd1a10b589811fc4828c1a2e0c6d}{setZero}});}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{comment}{//\ compute\ the\ norm\ of\ the\ residual}}
\DoxyCodeLine{00068\ \ \ \ \ \mbox{\hyperlink{bt_scalar_8h_a1e5824cfc8adbf5a77f2622132d16018}{btScalar}}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a9fa0f149fb0f059c32a701b177a5371d}{computeNorm}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ residual)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{comment}{//\ compute\ one\ step\ of\ the\ solve\ (there\ is\ only\ one\ solve\ if\ the\ system\ is\ linear)}}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a8cda16fbc56cc340d330319a2665cd07}{computeStep}}(\mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ dv,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ residual,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{bt_scalar_8h_a1e5824cfc8adbf5a77f2622132d16018}{btScalar}}\&\ dt);}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{comment}{//\ perform\ A*x\ =\ b}}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_ad0981913536b47305fa4fef8ba42adab}{multiply}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ \mbox{\hyperlink{glad_8h_a92d0386e5c19fb81ea88c9f99644ab1d}{x}},\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ \mbox{\hyperlink{glad_8h_a6eba317e3cf44d6d26c04a5a8f197dcb}{b}})\ \textcolor{keyword}{const};}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{comment}{//\ set\ initial\ guess\ for\ CG\ solve}}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a9e6d6004d29ccfe7443c40f7bf190503}{initialGuess}}(\mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ dv,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ residual);}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{comment}{//\ reset\ data\ structure\ and\ reset\ dt}}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_ae90fe0e0c78b75a2addda6f327c77129}{reinitialize}}(\textcolor{keywordtype}{bool}\ nodeUpdated,\ \mbox{\hyperlink{bt_scalar_8h_a1e5824cfc8adbf5a77f2622132d16018}{btScalar}}\ dt);}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_ad89b974d39abe760b6a6018fdbb80772}{setDt}}(\mbox{\hyperlink{bt_scalar_8h_a1e5824cfc8adbf5a77f2622132d16018}{btScalar}}\ dt);}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{comment}{//\ add\ friction\ force\ to\ residual}}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a6321a35bb0d177814f1acf438d0edf7c}{applyDynamicFriction}}(\mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ \mbox{\hyperlink{glad_8h_abe08814c2f72843fde4d8df41440d5a0}{r}});}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{comment}{//\ add\ dv\ to\ velocity}}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a39a851fa7d81ccca47f42c6d46f2e989}{updateVelocity}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ dv);}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{comment}{//set\ constraints\ as\ projections}}
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a2e04b737741e47502973568ec00060a3}{setConstraints}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_contact_solver_info}{btContactSolverInfo}}\&\ \mbox{\hyperlink{bt_sequential_impulse_constraint_solver_mt_8h_ac20389276c153b99e54fa17341cfe420}{infoGlobal}});}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{comment}{//\ update\ the\ projections\ and\ project\ the\ residual}}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_aab35687f13b531e2ecfb3002366daf5b}{project}}(\mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ \mbox{\hyperlink{glad_8h_abe08814c2f72843fde4d8df41440d5a0}{r}})}
\DoxyCodeLine{00095\ \ \ \ \ \{}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bt_quickprof_8h_a313914a100622c10c4c094bbab420a37}{BT\_PROFILE}}(\textcolor{stringliteral}{"{}project"{}});}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a25ce6dacbbc16e7dd0f56990c04c3806}{m\_projection}}.project(\mbox{\hyperlink{glad_8h_abe08814c2f72843fde4d8df41440d5a0}{r}});}
\DoxyCodeLine{00098\ \ \ \ \ \}}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{comment}{//\ perform\ precondition\ M\string^(-\/1)\ x\ =\ b}}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a1035f773af02a104c38f658031c1f049}{precondition}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ \mbox{\hyperlink{glad_8h_a92d0386e5c19fb81ea88c9f99644ab1d}{x}},\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ \mbox{\hyperlink{glad_8h_a6eba317e3cf44d6d26c04a5a8f197dcb}{b}})}
\DoxyCodeLine{00102\ \ \ \ \ \{}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_ab168566afac15059e59e12c83c975f23}{m\_preconditioner}}-\/>operator()(\mbox{\hyperlink{glad_8h_a92d0386e5c19fb81ea88c9f99644ab1d}{x}},\ \mbox{\hyperlink{glad_8h_a6eba317e3cf44d6d26c04a5a8f197dcb}{b}});}
\DoxyCodeLine{00104\ \ \ \ \ \}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{comment}{//\ reindex\ all\ the\ vertices}}
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a54fe5a2b2f25f63053985de638d71cf6}{updateId}}()}
\DoxyCodeLine{00108\ \ \ \ \ \{}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ node\_id\ =\ 0;}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ face\_id\ =\ 0;}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a583aeeb9b2c6e30ce4d3ab52373c2b30}{m\_nodes}}.clear();}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a8ac48196a5abb94fcb4aae7a9b344346}{m\_softBodies}}.size();\ ++i)}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_soft_body}{btSoftBody}}*\ psb\ =\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a8ac48196a5abb94fcb4aae7a9b344346}{m\_softBodies}}[i];}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ psb-\/>\mbox{\hyperlink{classbt_soft_body_ad53c95f39d517c1b72db24f175e92fb5}{m\_nodes}}.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();\ ++j)}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ psb-\/>\mbox{\hyperlink{classbt_soft_body_ad53c95f39d517c1b72db24f175e92fb5}{m\_nodes}}[j].index\ =\ node\_id;}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a583aeeb9b2c6e30ce4d3ab52373c2b30}{m\_nodes}}.push\_back(\&psb-\/>\mbox{\hyperlink{classbt_soft_body_ad53c95f39d517c1b72db24f175e92fb5}{m\_nodes}}[j]);}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++node\_id;}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ psb-\/>\mbox{\hyperlink{classbt_soft_body_a76a8ea9e874b87a9dc51846cc24f3a4f}{m\_faces}}.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();\ ++j)}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ psb-\/>\mbox{\hyperlink{classbt_soft_body_a76a8ea9e874b87a9dc51846cc24f3a4f}{m\_faces}}[j].m\_index\ =\ face\_id;}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++face\_id;}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00127\ \ \ \ \ \}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_aligned_object_array}{btAlignedObjectArray<btSoftBody::Node*>}}*\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a9373f0b5048ff6d0c6357a0b5120689b}{getIndices}}()\textcolor{keyword}{\ const}}
\DoxyCodeLine{00130\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \&\mbox{\hyperlink{classbt_deformable_backward_euler_objective_a583aeeb9b2c6e30ce4d3ab52373c2b30}{m\_nodes}};}
\DoxyCodeLine{00132\ \ \ \ \ \}}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a46f5db9ffbe9dbcf3bc32cdec407df1b}{setImplicit}}(\textcolor{keywordtype}{bool}\ implicit)}
\DoxyCodeLine{00135\ \ \ \ \ \{}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_ad515c0c1cffa17554546f366c88a7b88}{m\_implicit}}\ =\ implicit;}
\DoxyCodeLine{00137\ \ \ \ \ \}}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{comment}{//\ Calculate\ the\ total\ potential\ energy\ in\ the\ system}}
\DoxyCodeLine{00140\ \ \ \ \ \mbox{\hyperlink{bt_scalar_8h_a1e5824cfc8adbf5a77f2622132d16018}{btScalar}}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a5d71f44dd7d842b3732f18351fa97754}{totalEnergy}}(\mbox{\hyperlink{bt_scalar_8h_a1e5824cfc8adbf5a77f2622132d16018}{btScalar}}\ dt);}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a69386a330bc7bdcdab2158a229b5c054}{addLagrangeMultiplier}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ vec,\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ extended\_vec)}
\DoxyCodeLine{00143\ \ \ \ \ \{}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ extended\_vec.\mbox{\hyperlink{classbt_aligned_object_array_a6a48cd9cb91d0cfa50ee1c70ef485190}{resize}}(vec.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}()\ +\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a25ce6dacbbc16e7dd0f56990c04c3806}{m\_projection}}.m\_lagrangeMultipliers.size());}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ vec.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();\ ++i)}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ \ \ extended\_vec[i]\ =\ vec[i];}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ae1b92ae085ddef4b1cdca7d749339fb0}{offset}}\ =\ vec.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a25ce6dacbbc16e7dd0f56990c04c3806}{m\_projection}}.m\_lagrangeMultipliers.size();\ ++i)}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ extended\_vec[\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ae1b92ae085ddef4b1cdca7d749339fb0}{offset}}\ +\ i].setZero();}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00154\ \ \ \ \ \}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_af1ac5efcaefc92c53cd9ecda23da4f30}{addLagrangeMultiplierRHS}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ residual,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ m\_dv,\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ extended\_residual)}
\DoxyCodeLine{00157\ \ \ \ \ \{}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ extended\_residual.\mbox{\hyperlink{classbt_aligned_object_array_a6a48cd9cb91d0cfa50ee1c70ef485190}{resize}}(residual.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}()\ +\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a25ce6dacbbc16e7dd0f56990c04c3806}{m\_projection}}.m\_lagrangeMultipliers.size());}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ residual.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();\ ++i)}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \ \ \ \ extended\_residual[i]\ =\ residual[i];}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ae1b92ae085ddef4b1cdca7d749339fb0}{offset}}\ =\ residual.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a25ce6dacbbc16e7dd0f56990c04c3806}{m\_projection}}.m\_lagrangeMultipliers.size();\ ++i)}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{struct_lagrange_multiplier}{LagrangeMultiplier}}\&\ lm\ =\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a25ce6dacbbc16e7dd0f56990c04c3806}{m\_projection}}.m\_lagrangeMultipliers[i];}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ \ \ extended\_residual[\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ae1b92ae085ddef4b1cdca7d749339fb0}{offset}}\ +\ i].setZero();}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ d\ =\ 0;\ d\ <\ lm.\mbox{\hyperlink{struct_lagrange_multiplier_a720ead11c908acd540d26a1dbb87f769}{m\_num\_constraints}};\ ++d)}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ n\ =\ 0;\ n\ <\ lm.\mbox{\hyperlink{struct_lagrange_multiplier_a24b5e5d3c7701f224ea51302752c843e}{m\_num\_nodes}};\ ++n)}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ extended\_residual[\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ae1b92ae085ddef4b1cdca7d749339fb0}{offset}}\ +\ i][d]\ +=\ lm.\mbox{\hyperlink{struct_lagrange_multiplier_ab5df03e044397d9eb85a8dbe070e5603}{m\_weights}}[n]\ *\ m\_dv[lm.\mbox{\hyperlink{struct_lagrange_multiplier_a39c1b615b964973572fc650e9857a79a}{m\_indices}}[n]].dot(lm.\mbox{\hyperlink{struct_lagrange_multiplier_aab57eb70f2f2e8eabf7cc89f42d3e8be}{m\_dirs}}[d]);}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00176\ \ \ \ \ \}}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a0f293815d6970ace5723f2aa71720a80}{calculateContactForce}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ dv,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ rhs,\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a018de6fae7bcd8bd6bf35210df390e12}{TVStack}}\&\ \mbox{\hyperlink{glad_8h_ae29c29480f1260cc37ad71203904ea4d}{f}})}
\DoxyCodeLine{00179\ \ \ \ \ \{}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ counter\ =\ 0;}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a8ac48196a5abb94fcb4aae7a9b344346}{m\_softBodies}}.size();\ ++i)}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_soft_body}{btSoftBody}}*\ psb\ =\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a8ac48196a5abb94fcb4aae7a9b344346}{m\_softBodies}}[i];}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ psb-\/>\mbox{\hyperlink{classbt_soft_body_ad53c95f39d517c1b72db24f175e92fb5}{m\_nodes}}.\mbox{\hyperlink{classbt_aligned_object_array_a31de8d83d29c6edd1493fc583091194c}{size}}();\ ++j)}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_soft_body_1_1_node}{btSoftBody::Node}}\&\ node\ =\ psb-\/>\mbox{\hyperlink{classbt_soft_body_ad53c95f39d517c1b72db24f175e92fb5}{m\_nodes}}[j];}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{glad_8h_ae29c29480f1260cc37ad71203904ea4d}{f}}[counter]\ =\ (node.\mbox{\hyperlink{structbt_soft_body_1_1_node_a24a6d86c8fb27545c995e3664cf47298}{m\_im}}\ ==\ 0)\ ?\ \mbox{\hyperlink{bt_vector3_8h_a755c140e1fbddef09844cf2873258525}{btVector3}}(0,\ 0,\ 0)\ :\ dv[counter]\ /\ node.\mbox{\hyperlink{structbt_soft_body_1_1_node_a24a6d86c8fb27545c995e3664cf47298}{m\_im}};}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++counter;}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a48f0e64adf5cf2302037f73c6e3455a8}{m\_lf}}.size();\ ++i)}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ add\ damping\ matrix}}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_a48f0e64adf5cf2302037f73c6e3455a8}{m\_lf}}[i]-\/>addScaledDampingForceDifferential(-\/\mbox{\hyperlink{classbt_deformable_backward_euler_objective_a4afec8e005cc03deca05f5136c58c8e5}{m\_dt}},\ dv,\ \mbox{\hyperlink{glad_8h_ae29c29480f1260cc37ad71203904ea4d}{f}});}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ counter\ =\ 0;}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (;\ counter\ <\ \mbox{\hyperlink{glad_8h_ae29c29480f1260cc37ad71203904ea4d}{f}}.size();\ ++counter)}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{glad_8h_ae29c29480f1260cc37ad71203904ea4d}{f}}[counter]\ =\ rhs[counter]\ -\/\ \mbox{\hyperlink{glad_8h_ae29c29480f1260cc37ad71203904ea4d}{f}}[counter];}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00201\ \ \ \ \ \}}
\DoxyCodeLine{00202\ \};}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ btBackwardEulerObjective\_h\ */}\textcolor{preprocessor}{}}

\end{DoxyCode}
