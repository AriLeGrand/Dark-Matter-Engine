\doxysection{bt\+Deformable\+Body\+Solver.\+h}
\hypertarget{bt_deformable_body_solver_8h_source}{}\label{bt_deformable_body_solver_8h_source}\index{C:/Users/quant/source/repos/Dark-\/Matter-\/Engine/ENGINE/Libraries/include/Bullet/BulletSoftBody/btDeformableBodySolver.h@{C:/Users/quant/source/repos/Dark-\/Matter-\/Engine/ENGINE/Libraries/include/Bullet/BulletSoftBody/btDeformableBodySolver.h}}
\mbox{\hyperlink{bt_deformable_body_solver_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ Written\ by\ Xuchen\ Han\ <xuchenhan2015@u.northwestern.edu>}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ }}
\DoxyCodeLine{00004\ \textcolor{comment}{\ Bullet\ Continuous\ Collision\ Detection\ and\ Physics\ Library}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ Copyright\ (c)\ 2019\ Google\ Inc.\ http://bulletphysics.org}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ This\ software\ is\ provided\ 'as-\/is',\ without\ any\ express\ or\ implied\ warranty.}}
\DoxyCodeLine{00007\ \textcolor{comment}{\ In\ no\ event\ will\ the\ authors\ be\ held\ liable\ for\ any\ damages\ arising\ from\ the\ use\ of\ this\ software.}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ Permission\ is\ granted\ to\ anyone\ to\ use\ this\ software\ for\ any\ purpose,}}
\DoxyCodeLine{00009\ \textcolor{comment}{\ including\ commercial\ applications,\ and\ to\ alter\ it\ and\ redistribute\ it\ freely,}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ subject\ to\ the\ following\ restrictions:}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ 1.\ The\ origin\ of\ this\ software\ must\ not\ be\ misrepresented;\ you\ must\ not\ claim\ that\ you\ wrote\ the\ original\ software.\ If\ you\ use\ this\ software\ in\ a\ product,\ an\ acknowledgment\ in\ the\ product\ documentation\ would\ be\ appreciated\ but\ is\ not\ required.}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ 2.\ Altered\ source\ versions\ must\ be\ plainly\ marked\ as\ such,\ and\ must\ not\ be\ misrepresented\ as\ being\ the\ original\ software.}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ 3.\ This\ notice\ may\ not\ be\ removed\ or\ altered\ from\ any\ source\ distribution.}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#ifndef\ BT\_DEFORMABLE\_BODY\_SOLVERS\_H}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#define\ BT\_DEFORMABLE\_BODY\_SOLVERS\_H}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bt_soft_body_solvers_8h}{btSoftBodySolvers.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bt_deformable_backward_euler_objective_8h}{btDeformableBackwardEulerObjective.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bt_deformable_multi_body_dynamics_world_8h}{btDeformableMultiBodyDynamicsWorld.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bt_multi_body_link_collider_8h}{BulletDynamics/Featherstone/btMultiBodyLinkCollider.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bt_multi_body_constraint_8h}{BulletDynamics/Featherstone/btMultiBodyConstraint.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bt_conjugate_residual_8h}{btConjugateResidual.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bt_conjugate_gradient_8h}{btConjugateGradient.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structbt_collision_object_wrapper}{btCollisionObjectWrapper}};}
\DoxyCodeLine{00027\ \textcolor{comment}{//\ class\ btDeformableBackwardEulerObjective;}}
\DoxyCodeLine{00028\ \textcolor{comment}{//\ class\ btDeformableMultiBodyDynamicsWorld;}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classbt_deformable_body_solver_a1795caff4f86e58672441b29146b7db9}{btDeformableBodySolver}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classbt_soft_body_solver_a8402400b6cfef31ca883a787d5a72956}{btSoftBodySolver}}}
\DoxyCodeLine{00031\ \{}
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classbt_aligned_object_array}{btAlignedObjectArray<btVector3>}}\ TVStack;}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classbt_deformable_body_solver_a1c3188f55b08e609669d9f2d14ebb461}{m\_numNodes}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ total\ number\ of\ deformable\ body\ nodes}}
\DoxyCodeLine{00036\ \ \ \ \ TVStack\ \mbox{\hyperlink{classbt_deformable_body_solver_a9a2ac996733edd8540610a37bc97838a}{m\_dv}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ v\_\{n+1\}\ -\/\ v\_n}}
\DoxyCodeLine{00037\ \ \ \ \ TVStack\ \mbox{\hyperlink{classbt_deformable_body_solver_a9322c4bdf97fafbcfce15d9212e63a09}{m\_backup\_dv}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ backed\ up\ dv}}
\DoxyCodeLine{00038\ \ \ \ \ TVStack\ \mbox{\hyperlink{classbt_deformable_body_solver_a05789c4dd6ebe829bf392b83da76a3f7}{m\_ddv}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ incremental\ dv}}
\DoxyCodeLine{00039\ \ \ \ \ TVStack\ \mbox{\hyperlink{classbt_deformable_body_solver_ab65a3af1b696a86e55395c79f6c2f0e5}{m\_residual}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ rhs\ of\ the\ linear\ solve}}
\DoxyCodeLine{00040\ \ \ \ \ \mbox{\hyperlink{classbt_aligned_object_array}{btAlignedObjectArray<btSoftBody*>}}\ \mbox{\hyperlink{classbt_deformable_body_solver_ac4b85bedac031beab5119cd0a8b5be43}{m\_softBodies}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ all\ deformable\ bodies}}
\DoxyCodeLine{00041\ \ \ \ \ TVStack\ \mbox{\hyperlink{classbt_deformable_body_solver_af423246ea44c4203f37f5d3eed6e78e5}{m\_backupVelocity}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ backed\ up\ v,\ equals\ v\_n\ for\ implicit,\ equals\ v\_\{n+1\}\string^*\ for\ explicit}}
\DoxyCodeLine{00042\ \ \ \ \ \mbox{\hyperlink{bt_scalar_8h_a1e5824cfc8adbf5a77f2622132d16018}{btScalar}}\ \mbox{\hyperlink{classbt_deformable_body_solver_ad3633659e5a926ffaf321e335a1c096b}{m\_dt}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ dt}}
\DoxyCodeLine{00043\ \ \ \ \ \mbox{\hyperlink{classbt_conjugate_gradient}{btConjugateGradient<btDeformableBackwardEulerObjective>}}\ \mbox{\hyperlink{classbt_deformable_body_solver_a96490fdf36dc7c22f4f0b95b6f02832e}{m\_cg}};\ \ \textcolor{comment}{//\ CG\ solver}}
\DoxyCodeLine{00044\ \ \ \ \ \mbox{\hyperlink{classbt_conjugate_residual}{btConjugateResidual<btDeformableBackwardEulerObjective>}}\ \mbox{\hyperlink{classbt_deformable_body_solver_a90a338edfecd0e8e47e378274fc428c6}{m\_cr}};\ \ \textcolor{comment}{//\ CR\ solver}}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classbt_deformable_body_solver_ad8e8b91c32445efe40c2879fbe649a5e}{m\_implicit}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ use\ implicit\ scheme\ if\ true,\ explicit\ scheme\ if\ false}}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classbt_deformable_body_solver_a6ffc30a9b33c958dd60b4f868fe00f82}{m\_maxNewtonIterations}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ max\ number\ of\ newton\ iterations}}
\DoxyCodeLine{00047\ \ \ \ \ \mbox{\hyperlink{bt_scalar_8h_a1e5824cfc8adbf5a77f2622132d16018}{btScalar}}\ \mbox{\hyperlink{classbt_deformable_body_solver_adb2b015e796ba9e47b845c1fa98d4483}{m\_newtonTolerance}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ stop\ newton\ iterations\ if\ f(x)\ <\ m\_newtonTolerance}}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classbt_deformable_body_solver_ae0b02fbc51f758ff6f91c774d8fb5a25}{m\_lineSearch}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ true,\ use\ newton's\ method\ with\ line\ search\ under\ implicit\ scheme}}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classbt_deformable_body_solver_a721d174a34ac526a4b84872ca132744c}{m\_reducedSolver}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ flag\ for\ reduced\ soft\ body\ solver}}
\DoxyCodeLine{00050\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{comment}{//\ handles\ data\ related\ to\ objective\ function}}
\DoxyCodeLine{00052\ \ \ \ \ \mbox{\hyperlink{classbt_deformable_backward_euler_objective}{btDeformableBackwardEulerObjective}}*\ \mbox{\hyperlink{classbt_deformable_body_solver_a372b6a697cdf22c5ae6e74ac66a806a4}{m\_objective}};}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classbt_deformable_body_solver_ada9f49f60a90f86a10fa1a3127cfcd5b}{m\_useProjection}};}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \ \ \mbox{\hyperlink{classbt_deformable_body_solver_a1795caff4f86e58672441b29146b7db9}{btDeformableBodySolver}}();}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classbt_deformable_body_solver_a34c9e15928f9b305c64973a2681abf41}{\string~btDeformableBodySolver}}();}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classbt_soft_body_solver_ae50676e1c9c6cdb0e3e59bd426baf540}{SolverTypes}}\ \mbox{\hyperlink{classbt_deformable_body_solver_a22ee7c274ddeaad805f1ed1d4c12ec8d}{getSolverType}}()\textcolor{keyword}{\ const}}
\DoxyCodeLine{00060\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classbt_soft_body_solver_ae50676e1c9c6cdb0e3e59bd426baf540a9e210295e407a47f5da878a8872984ab}{DEFORMABLE\_SOLVER}};}
\DoxyCodeLine{00062\ \ \ \ \ \}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{comment}{//\ update\ soft\ body\ normals}}
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_a0d0c73b82db9f6bd6cab8683f67ffd86}{updateSoftBodies}}();}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{bt_scalar_8h_a1e5824cfc8adbf5a77f2622132d16018}{btScalar}}\ \mbox{\hyperlink{classbt_deformable_body_solver_ad1ce8bb68d00d99747d024f666b5ea0a}{solveContactConstraints}}(\mbox{\hyperlink{bt_collision_object_8h_a162a0e48dd47198d73efdd1fef8747cb}{btCollisionObject}}**\ deformableBodies,\ \textcolor{keywordtype}{int}\ numDeformableBodies,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_contact_solver_info}{btContactSolverInfo}}\&\ \mbox{\hyperlink{bt_sequential_impulse_constraint_solver_mt_8h_ac20389276c153b99e54fa17341cfe420}{infoGlobal}});}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{comment}{//\ solve\ the\ momentum\ equation}}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_a18ee229c8aae41ece129a46331713380}{solveDeformableConstraints}}(\mbox{\hyperlink{bt_scalar_8h_a1e5824cfc8adbf5a77f2622132d16018}{btScalar}}\ solverdt);}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{comment}{//\ set\ gravity\ (get\ from\ deformable\ world)}}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_af704a6fecaa9660363dff46b3d041bea}{setGravity}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{bt_vector3_8h_a755c140e1fbddef09844cf2873258525}{btVector3}}\&\ gravity)}
\DoxyCodeLine{00074\ \ \ \ \ \{}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ full\ deformable\ object,\ we\ don't\ store\ gravity\ in\ the\ solver}}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ this\ function\ is\ overriden\ in\ the\ reduced\ deformable\ object}}
\DoxyCodeLine{00077\ \ \ \ \ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{comment}{//\ resize/clear\ data\ structures}}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_aae334968754e3abaedf1474d3bc3b463}{reinitialize}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_aligned_object_array}{btAlignedObjectArray<btSoftBody*>}}\&\ softBodies,\ \mbox{\hyperlink{bt_scalar_8h_a1e5824cfc8adbf5a77f2622132d16018}{btScalar}}\ dt);}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{comment}{//\ set\ up\ contact\ constraints}}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_a27165b348df627862d7de4ac8dbdea5e}{setConstraints}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_contact_solver_info}{btContactSolverInfo}}\&\ \mbox{\hyperlink{bt_sequential_impulse_constraint_solver_mt_8h_ac20389276c153b99e54fa17341cfe420}{infoGlobal}});}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{comment}{//\ add\ in\ elastic\ forces\ and\ gravity\ to\ obtain\ v\_\{n+1\}\string^*\ and\ calls\ predictDeformableMotion}}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_adf376ce8988b685092b6a99f8b54fea1}{predictMotion}}(\mbox{\hyperlink{bt_scalar_8h_a1e5824cfc8adbf5a77f2622132d16018}{btScalar}}\ solverdt);}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{comment}{//\ move\ to\ temporary\ position\ x\_\{n+1\}\string^*\ =\ x\_n\ +\ dt\ *\ v\_\{n+1\}\string^*}}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{comment}{//\ x\_\{n+1\}\string^*\ is\ stored\ in\ m\_q}}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_a83ef7fca29cc229027562f08baac6de4}{predictDeformableMotion}}(\mbox{\hyperlink{classbt_soft_body}{btSoftBody}}*\ psb,\ \mbox{\hyperlink{bt_scalar_8h_a1e5824cfc8adbf5a77f2622132d16018}{btScalar}}\ dt);}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{comment}{//\ save\ the\ current\ velocity\ to\ m\_backupVelocity}}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_a98951a5568513f2172ac02a012f066df}{backupVelocity}}();}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{comment}{//\ set\ m\_dv\ and\ m\_backupVelocity\ to\ desired\ value\ to\ prepare\ for\ momentum\ solve}}
\DoxyCodeLine{00096\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_ab1e59ba64227cd0e1a8121f332f91261}{setupDeformableSolve}}(\textcolor{keywordtype}{bool}\ implicit);}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{comment}{//\ set\ the\ current\ velocity\ to\ that\ backed\ up\ in\ m\_backupVelocity}}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_a1d3fb6fb20d96a3d67951205abf3f34b}{revertVelocity}}();}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{comment}{//\ set\ velocity\ to\ m\_dv\ +\ m\_backupVelocity}}
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_ad3b9f1f83392c89d12504ce38ea6be65}{updateVelocity}}();}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{comment}{//\ update\ the\ node\ count}}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classbt_deformable_body_solver_a38dd26ae6e5f64fe2c8c94d7d761ce88}{updateNodes}}();}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{comment}{//\ calculate\ the\ change\ in\ dv\ resulting\ from\ the\ momentum\ solve}}
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_aeeb903b78068be269f536c6039beb01e}{computeStep}}(TVStack\&\ ddv,\ \textcolor{keyword}{const}\ TVStack\&\ residual);}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{comment}{//\ calculate\ the\ change\ in\ dv\ resulting\ from\ the\ momentum\ solve\ when\ line\ search\ is\ turned\ on}}
\DoxyCodeLine{00111\ \ \ \ \ \mbox{\hyperlink{bt_scalar_8h_a1e5824cfc8adbf5a77f2622132d16018}{btScalar}}\ \mbox{\hyperlink{classbt_deformable_body_solver_a70865462727f8b43ff989cf1c7ff8c1d}{computeDescentStep}}(TVStack\&\ ddv,\ \textcolor{keyword}{const}\ TVStack\&\ residual,\ \textcolor{keywordtype}{bool}\ verbose\ =\ \textcolor{keyword}{false});}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_a78af136909aa096a11edaeeb99d92006}{copySoftBodyToVertexBuffer}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_soft_body}{btSoftBody}}*\ \textcolor{keyword}{const}\ softBody,\ \mbox{\hyperlink{classbt_vertex_buffer_descriptor}{btVertexBufferDescriptor}}*\ vertexBuffer)\ \{\}}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{comment}{//\ process\ collision\ between\ deformable\ and\ rigid}}
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_a2b910416b60ad6b06f946bd871eabcda}{processCollision}}(\mbox{\hyperlink{classbt_soft_body}{btSoftBody}}*\ softBody,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbt_collision_object_wrapper}{btCollisionObjectWrapper}}*\ collisionObjectWrap)}
\DoxyCodeLine{00117\ \ \ \ \ \{}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ softBody-\/>\mbox{\hyperlink{classbt_soft_body_a2efae0290d22ed8c05ef4540586283c5}{defaultCollisionHandler}}(collisionObjectWrap);}
\DoxyCodeLine{00119\ \ \ \ \ \}}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{comment}{//\ process\ collision\ between\ deformable\ and\ deformable}}
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_a0118378f5c8ac8124eb1b3140586f26e}{processCollision}}(\mbox{\hyperlink{classbt_soft_body}{btSoftBody}}*\ softBody,\ \mbox{\hyperlink{classbt_soft_body}{btSoftBody}}*\ otherSoftBody)}
\DoxyCodeLine{00123\ \ \ \ \ \{}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ softBody-\/>\mbox{\hyperlink{classbt_soft_body_a2efae0290d22ed8c05ef4540586283c5}{defaultCollisionHandler}}(otherSoftBody);}
\DoxyCodeLine{00125\ \ \ \ \ \}}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{comment}{//\ If\ true,\ implicit\ time\ stepping\ scheme\ is\ used.}}
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ explicit\ time\ stepping\ scheme\ is\ used}}
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_aea780ae53cc600b73a520a93c889e9e3}{setImplicit}}(\textcolor{keywordtype}{bool}\ implicit);}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{comment}{//\ If\ true,\ newton's\ method\ with\ line\ search\ is\ used\ when\ implicit\ time\ stepping\ scheme\ is\ turned\ on}}
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_ac362a587d22ed0ff53c660a82e0423b2}{setLineSearch}}(\textcolor{keywordtype}{bool}\ lineSearch);}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{comment}{//\ set\ temporary\ position\ x\string^*\ =\ x\_n\ +\ dt\ *\ v}}
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{comment}{//\ update\ the\ deformation\ gradient\ at\ position\ x\string^*}}
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_a588f76e8bcc5fbf2a848480c5969d73f}{updateState}}();}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{comment}{//\ set\ dv\ =\ dv\ +\ scale\ *\ ddv}}
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_afd9f975e83dffc1511c5bd151ab7aa80}{updateDv}}(\mbox{\hyperlink{bt_scalar_8h_a1e5824cfc8adbf5a77f2622132d16018}{btScalar}}\ scale\ =\ 1);}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{comment}{//\ set\ temporary\ position\ x\string^*\ =\ x\_n\ +\ dt\ *\ v\string^*}}
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_af3194dd7dbb9a2aa32da342afa4eaee3}{updateTempPosition}}();}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{comment}{//\ save\ the\ current\ dv\ to\ m\_backup\_dv;}}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_ae14b01aa29c352d61b1d2ca365822a89}{backupDv}}();}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{comment}{//\ set\ dv\ to\ the\ backed-\/up\ value}}
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_aa091f939e8f466e3e2c965eaad365067}{revertDv}}();}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{comment}{//\ set\ dv\ =\ dv\ +\ scale\ *\ ddv}}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{comment}{//\ set\ v\string^*\ =\ v\_n\ +\ dv}}
\DoxyCodeLine{00152\ \ \ \ \ \textcolor{comment}{//\ set\ temporary\ position\ x\string^*\ =\ x\_n\ +\ dt\ *\ v\string^*}}
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{comment}{//\ update\ the\ deformation\ gradient\ at\ position\ x\string^*}}
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_a1cbe88cf3bfba06f1a9dfbfd2f5e8f4c}{updateEnergy}}(\mbox{\hyperlink{bt_scalar_8h_a1e5824cfc8adbf5a77f2622132d16018}{btScalar}}\ scale);}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{comment}{//\ calculates\ the\ appropriately\ scaled\ kinetic\ energy\ in\ the\ system,\ which\ is}}
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{comment}{//\ 1/2\ *\ dv\string^T\ *\ M\ *\ dv}}
\DoxyCodeLine{00158\ \ \ \ \ \textcolor{comment}{//\ used\ in\ line\ search}}
\DoxyCodeLine{00159\ \ \ \ \ \mbox{\hyperlink{bt_scalar_8h_a1e5824cfc8adbf5a77f2622132d16018}{btScalar}}\ \mbox{\hyperlink{classbt_deformable_body_solver_ad7707bbe40d92f4354daa765daa1b438}{kineticEnergy}}();}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{comment}{//\ add\ explicit\ force\ to\ the\ velocity\ in\ the\ objective\ class}}
\DoxyCodeLine{00162\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_af6e56aab57c2ea88c510c4aa06c89c14}{applyExplicitForce}}();}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{comment}{//\ execute\ position/velocity\ update\ and\ apply\ anchor\ constraints\ in\ the\ integrateTransforms\ from\ the\ Dynamics\ world}}
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_a3a3df25d6d04268b068c0bc124dc4cfa}{applyTransforms}}(\mbox{\hyperlink{bt_scalar_8h_a1e5824cfc8adbf5a77f2622132d16018}{btScalar}}\ timeStep);}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_a47a7dc1f342e061c12a987e6d0512de3}{setStrainLimiting}}(\textcolor{keywordtype}{bool}\ opt)}
\DoxyCodeLine{00168\ \ \ \ \ \{}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_deformable_body_solver_a372b6a697cdf22c5ae6e74ac66a806a4}{m\_objective}}-\/>m\_projection.m\_useStrainLimiting\ =\ opt;}
\DoxyCodeLine{00170\ \ \ \ \ \}}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_a5f7387b2b2b67493b6b71384b61d9dec}{setPreconditioner}}(\textcolor{keywordtype}{int}\ opt)}
\DoxyCodeLine{00173\ \ \ \ \ \{}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (opt)}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_ac59c9d8a49ee1d054f9fae9111834d1daf5c9978db4229dd8f99960e95b3619b0}{btDeformableBackwardEulerObjective::Mass\_preconditioner}}:}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_deformable_body_solver_a372b6a697cdf22c5ae6e74ac66a806a4}{m\_objective}}-\/>m\_preconditioner\ =\ \mbox{\hyperlink{classbt_deformable_body_solver_a372b6a697cdf22c5ae6e74ac66a806a4}{m\_objective}}-\/>m\_massPreconditioner;}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classbt_deformable_backward_euler_objective_ac59c9d8a49ee1d054f9fae9111834d1da01271506363505443a0b9f37f8a626ee}{btDeformableBackwardEulerObjective::KKT\_preconditioner}}:}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_deformable_body_solver_a372b6a697cdf22c5ae6e74ac66a806a4}{m\_objective}}-\/>m\_preconditioner\ =\ \mbox{\hyperlink{classbt_deformable_body_solver_a372b6a697cdf22c5ae6e74ac66a806a4}{m\_objective}}-\/>m\_KKTPreconditioner;}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bt_scalar_8h_aff3e6078c073f6ba0edb95353f2c2c62}{btAssert}}(\textcolor{keyword}{false});}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00188\ \ \ \ \ \}}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classbt_aligned_object_array}{btAlignedObjectArray<btDeformableLagrangianForce*>}}*\ \mbox{\hyperlink{classbt_deformable_body_solver_a98b37656cbf413809967c0a18c51a379}{getLagrangianForceArray}}()}
\DoxyCodeLine{00191\ \ \ \ \ \{}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \&(\mbox{\hyperlink{classbt_deformable_body_solver_a372b6a697cdf22c5ae6e74ac66a806a4}{m\_objective}}-\/>m\_lf);}
\DoxyCodeLine{00193\ \ \ \ \ \}}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classbt_aligned_object_array}{btAlignedObjectArray<btSoftBody::Node*>}}*\ \mbox{\hyperlink{classbt_deformable_body_solver_ac36834cad6e40e87f3efb2c9c3dd730f}{getIndices}}()}
\DoxyCodeLine{00196\ \ \ \ \ \{}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classbt_deformable_body_solver_a372b6a697cdf22c5ae6e74ac66a806a4}{m\_objective}}-\/>getIndices();}
\DoxyCodeLine{00198\ \ \ \ \ \}}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_a67c00b52534803b02d80402cae2fcb93}{setProjection}}()}
\DoxyCodeLine{00201\ \ \ \ \ \{}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_deformable_body_solver_a372b6a697cdf22c5ae6e74ac66a806a4}{m\_objective}}-\/>m\_projection.setProjection();}
\DoxyCodeLine{00203\ \ \ \ \ \}}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_af21fa3077d607205c82e8d68ac3f8f6a}{setLagrangeMultiplier}}()}
\DoxyCodeLine{00206\ \ \ \ \ \{}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classbt_deformable_body_solver_a372b6a697cdf22c5ae6e74ac66a806a4}{m\_objective}}-\/>m\_projection.setLagrangeMultiplier();}
\DoxyCodeLine{00208\ \ \ \ \ \}}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classbt_deformable_body_solver_aca7cab8b6825d000bd15239c543c6b54}{isReducedSolver}}()}
\DoxyCodeLine{00211\ \ \ \ \ \{}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classbt_deformable_body_solver_a721d174a34ac526a4b84872ca132744c}{m\_reducedSolver}};}
\DoxyCodeLine{00213\ \ \ \ \ \}}
\DoxyCodeLine{00214\ \ \ \ \ }
\DoxyCodeLine{00215\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_afa4df2e7fcb6573c6a4a2418570ded45}{deformableBodyInternalWriteBack}}()\ \{\}}
\DoxyCodeLine{00216\ }
\DoxyCodeLine{00217\ \ \ \ \ \textcolor{comment}{//\ unused\ functions}}
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_a849fde1c8d0618ff3b11afca7f4d7190}{optimize}}(\mbox{\hyperlink{classbt_aligned_object_array}{btAlignedObjectArray<btSoftBody*>}}\&\ softBodies,\ \textcolor{keywordtype}{bool}\ forceUpdate\ =\ \textcolor{keyword}{false})\ \{\}}
\DoxyCodeLine{00219\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_ad4cbd912221c0bc69e95abc2bb00bddd}{solveConstraints}}(\mbox{\hyperlink{bt_scalar_8h_a1e5824cfc8adbf5a77f2622132d16018}{btScalar}}\ dt)\ \{\}}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classbt_deformable_body_solver_a2620b1a76aefaec6dffc3b7fec432295}{checkInitialized}}()\ \{\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};\ \}}
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classbt_deformable_body_solver_a737d4a7bb99e5c1229e09bb85f04f368}{copyBackToSoftBodies}}(\textcolor{keywordtype}{bool}\ bMove\ =\ \textcolor{keyword}{true})\ \{\}}
\DoxyCodeLine{00222\ \};}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ btDeformableBodySolver\_h\ */}\textcolor{preprocessor}{}}

\end{DoxyCode}
